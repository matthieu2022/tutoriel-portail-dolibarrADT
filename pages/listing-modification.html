<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suivi des Modifications Dolibarr</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            /* max-width: 1400px; */
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar gauche */
        .sidebar {
            width: 30%;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-right: 1px solid #e9ecef;
            display: flex;
            flex-direction: column;
            max-height: 100vh;
            overflow-y: auto;
        }

        .sidebar-section {
            padding: 20px;
            border-bottom: 1px solid #dee2e6;
        }

        .sidebar-section:last-child {
            border-bottom: none;
            flex: 1;
            overflow-y: auto;
        }

        .sidebar-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.1rem;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }

        /* Style pour les éléments de modification dans la sidebar */
        .sidebar .modification-item {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }

        .sidebar .modification-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .sidebar .modification-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
            line-height: 1.2;
        }

        .sidebar .modification-meta {
            gap: 8px;
            flex-wrap: wrap;
        }

        .sidebar .badge {
            font-size: 0.7rem;
            padding: 2px 6px;
        }

        /* Style pour la section de téléchargement auto */
        .auto-download {
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f8f0 100%);
            border: 1px solid #4caf50;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .auto-download h4 {
            color: #2e7d32;
            font-size: 0.95rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .download-info {
            background: white;
            border: 1px solid #c8e6c9;
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 10px;
            font-size: 0.8rem;
            color: #2e7d32;
        }

        .download-filename {
            font-family: 'Courier New', monospace;
            background: #f1f8e9;
            padding: 2px 5px;
            border-radius: 3px;
            font-weight: 600;
        }

        .btn-auto-download {
            background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .btn-auto-download:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(76, 175, 80, 0.3);
        }

        .btn-auto-download:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Container principal */
        .main-container {
            width: 70%;
            display: flex;
            flex-direction: column;
            max-height: 100vh;
            overflow-y: auto;
        }

        .content {
            padding: 30px;
            flex: 1;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .navigation {
            background: #34495e;
            padding: 0;
            border-bottom: 3px solid #2c3e50;
        }

        .nav-tabs {
            display: flex;
            max-width: 1200px;
            margin: 0 auto;
            overflow-x: auto;
        }

        .nav-tab {
            background: none;
            border: none;
            color: #bdc3c7;
            padding: 15px 20px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .nav-tab:hover {
            background: rgba(255,255,255,0.1);
            color: #ecf0f1;
        }

        .nav-tab.active {
            background: rgba(255,255,255,0.15);
            color: #ecf0f1;
            border-bottom-color: #3498db;
        }

        .nav-badge {
            background: #e74c3c;
            color: white;
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 0.7rem;
            font-weight: 700;
            min-width: 18px;
            text-align: center;
        }

        .nav-badge.zero {
            background: #95a5a6;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .content {
            padding: 30px;
        }

        .form-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 5px solid #3498db;
        }

        .form-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        input, select, textarea {
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .btn {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .modifications-list {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .modification-item {
            border-bottom: 1px solid #e9ecef;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .modification-item:hover {
            background: #f8f9fa;
        }

        .modification-item:last-child {
            border-bottom: none;
        }

        .modification-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .modification-title {
            font-weight: 600;
            color: #2c3e50;
            font-size: 1.1rem;
        }

        .modification-date {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .modification-meta {
            display: flex;
            gap: 15px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge-module { background: #e3f2fd; color: #1976d2; }
        .badge-type { background: #f3e5f5; color: #7b1fa2; }
        .badge-priority { background: #fff3e0; color: #f57c00; }
        .badge-status { background: #e8f5e8; color: #388e3c; }

        .modification-description {
            color: #5a6c7d;
            line-height: 1.6;
        }

        .actions {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.8rem;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #7f8c8d;
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border-left: 4px solid #3498db;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #2c3e50;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                min-height: auto;
            }

            .sidebar {
                width: 100%;
                order: 2;
            }

            .main-container {
                width: 100%;
                order: 1;
            }

            .sidebar-section {
                padding: 15px;
            }

            .sidebar-section h3 {
                font-size: 1rem;
            }

            .sidebar-section ol {
                margin-left: 10px;
                font-size: 0.8rem;
            }

            .stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .modification-header {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar gauche -->
        <div class="sidebar">
            <!-- Travail collaboratif -->
            <div class="sidebar-section">
                <h3>👥 Travail collaboratif</h3>
                <p style="font-size: 0.9rem; line-height: 1.5; margin-bottom: 15px;"><strong>Workflow recommandé pour partager avec votre équipe :</strong></p>
                <ol style="margin-left: 15px; line-height: 1.4; font-size: 0.85rem;">
                    <li>🌅 <strong>Début de journée :</strong> Importez le fichier JSON depuis votre drive partagé</li>
                    <li>⚙️ <strong>Pendant la journée :</strong> Ajoutez/modifiez vos tâches (sauvegarde automatique locale)</li>
                    <li>🌆 <strong>Fin de journée :</strong> Exportez vos données et remplacez le fichier sur le drive partagé</li>
                    <li>💾 <strong>Fichier suggéré :</strong> <code style="background: #f1f3f4; padding: 2px 4px; border-radius: 3px;">modifications-dolibarr-equipe.json</code></li>
                </ol>
                <div style="background: #fff3cd; padding: 8px; border-radius: 5px; margin-top: 10px; border: 1px solid #ffc107; font-size: 0.8rem;">
                    <strong>💡 Conseil :</strong> Communiquez avec votre équipe avant d'exporter pour éviter les conflits !
                </div>
                
                <!-- Actions d'import/export dans la sidebar -->
                <div style="margin-top: 15px; display: flex; flex-direction: column; gap: 8px;">
                    <button class="btn btn-secondary" onclick="exportData()" style="font-size: 0.8rem; padding: 8px 12px;">📤 Exporter</button>
                    <button class="btn" onclick="document.getElementById('importFile').click()" style="font-size: 0.8rem; padding: 8px 12px;">📥 Importer</button>
                    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(this)">
                </div>

                <!-- Section téléchargement automatique -->
                <div class="auto-download">
                    <h4>🚀 Téléchargement rapide</h4>
                    <div class="download-info">
                        <strong>Fichier du jour :</strong><br>
                        <span class="download-filename" id="todayFilename">taches_02-01-2025.json</span>
                    </div>
                    <button class="btn-auto-download" onclick="downloadTodayFile()" id="downloadBtn">
                        📥 Télécharger directement
                    </button>
                </div>
            </div>

            <!-- Dernières modifications -->
            <div class="sidebar-section">
                <h3>📋 Dernières modifications</h3>
                <div id="recentModifications"></div>
            </div>
        </div>

        <!-- Container principal -->
        <div class="main-container">
            <div class="header">
                <h1>📋 Suivi des Modifications Dolibarr</h1>
                <p>Documentez et suivez toutes vos modifications système</p>
            </div>

            <!-- Navigation -->
            <nav class="navigation">
                <div class="nav-tabs">
                    <button class="nav-tab active" data-tab="accueil">🏠 Accueil</button>
                    <button class="nav-tab" data-tab="a-faire">⏳ À faire <span class="nav-badge" id="navBadgeAFaire">0</span></button>
                    <button class="nav-tab" data-tab="en-cours">⚙️ En cours <span class="nav-badge" id="navBadgeEnCours">0</span></button>
                    <button class="nav-tab" data-tab="en-test">🔍 En test <span class="nav-badge" id="navBadgeEnTest">0</span></button>
                    <button class="nav-tab" data-tab="terminees">✅ Terminées <span class="nav-badge" id="navBadgeTerminees">0</span></button>
                    <button class="nav-tab" data-tab="toutes">📋 Toutes <span class="nav-badge" id="navBadgeToutes">0</span></button>
                </div>
            </nav>

            <div class="content">
                <!-- Tab Accueil -->
                <div id="tab-accueil" class="tab-content active">
                    <!-- Statistiques -->
                    <div class="stats">
                        <div class="stat-card">
                            <div class="stat-number" id="totalModifications">0</div>
                            <div class="stat-label">Total Modifications</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="pendingModifications">0</div>
                            <div class="stat-label">En Attente</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="completedModifications">0</div>
                            <div class="stat-label">Terminées</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="testingModifications">0</div>
                            <div class="stat-label">En Test</div>
                        </div>
                    </div>

                    <!-- Statut de sauvegarde -->
                    <div class="form-section" style="background: #f0f9ff; border-left-color: #0ea5e9; padding: 15px;">
                        <div style="display: flex; align-items: center; gap: 10px; font-size: 0.9rem;">
                            <span style="color: #059669;">💾 Sauvegarde automatique active</span>
                            <span id="lastSaveInfo" style="color: #6b7280;"></span>
                        </div>
                    </div>

                <!-- Formulaire d'ajout -->
                <div class="form-section">
                    <h3>➕ Ajouter une Modification</h3>
                    <form id="modificationForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="titre">Titre de la modification *</label>
                                <input type="text" id="titre" required placeholder="ex: Modification workflow validation commandes">
                            </div>
                            <div class="form-group">
                                <label for="module">Module Dolibarr</label>
                                <select id="module">
                                    <option value="">Sélectionner un module</option>
                                    
                                    <optgroup label="🎨 1 - Thème & Design">
                                        <option value="Thème - Interface">Interface utilisateur</option>
                                        <option value="Thème - CSS">Styles CSS</option>
                                        <option value="Thème - Layout">Mise en page</option>
                                    </optgroup>
                                    
                                    <optgroup label="🔍 2 - Pré-opportunité">
                                        <option value="Pré-oppo - Leads">Gestion des leads</option>
                                    </optgroup>
                                    
                                    <optgroup label="👥 3 - Tiers & Contact">
                                        <option value="Tiers - Clients">tiers candidats</option>
                                        <option value="Tiers - Clients">tiers entreprise</option>
                                        <option value="Contact - Gestion">Gestion des contacts</option>
                                    </optgroup>
                                    
                                    <optgroup label="📋 4 - Projets">
                                        <option value="Projets - Gestion">Gestion de projets</option>
                                        <option value="Projets - Ressources">Gestion des ressources</option>
                                    </optgroup>
                                    
                                    <optgroup label="💼 5 - Commerce">
                                        <option value="Commerce - Propal">📄 Propositions commerciales</option>
                                        <option value="Commerce - Commande">🛒 Commandes clients</option>
                                    </optgroup>
                                    
                                    <optgroup label="⚙️ Autres modules">
                                        <option value="RH">Ressources Humaines</option>
                                        <option value="Comptabilité">Comptabilité</option>
                                        <option value="Adhérents">Adhérents</option>
                                        <option value="Agenda">Agenda</option>
                                        <option value="Configuration">Configuration système</option>
                                        <option value="Modules tiers">Modules tiers</option>
                                        <option value="API">API et intégrations</option>
                                        <option value="Autre">Autre</option>
                                    </optgroup>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="type">Type de modification</label>
                                <select id="type">
                                    <option value="">Sélectionner un type</option>
                                    <option value="Configuration">Configuration</option>
                                    <option value="Personnalisation">Personnalisation</option>
                                    <option value="Correction">Correction de bug</option>
                                    <option value="Amélioration">Amélioration</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="priorite">Priorité</label>
                                <select id="priorite">
                                    <option value="Basse">🟢 Basse</option>
                                    <option value="Normale" selected>🟡 Normale</option>
                                    <option value="Haute">🟠 Haute</option>
                                    <option value="Critique">🔴 Critique</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="statut">Statut</label>
                                <select id="statut">
                                    <option value="Planifiée">📋 Planifiée</option>
                                    <option value="En cours" selected>⚙️ En cours</option>
                                    <option value="En test">🔍 En test</option>
                                    <option value="Terminée">✅ Terminée</option>
                                    <option value="Annulée">❌ Annulée</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="version">Version Dolibarr</label>
                                <input type="text" id="version" placeholder="ex: 18.0.1">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="dateDebut">Date de début</label>
                                <input type="date" id="dateDebut">
                            </div>
                            <div class="form-group">
                                <label for="dateFin">Date de fin prévue</label>
                                <input type="date" id="dateFin">
                            </div>
                            <div class="form-group">
                                <label for="responsable">Responsable</label>
                                <input type="text" id="responsable" placeholder="Nom du responsable">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="description">Description détaillée *</label>
                            <textarea id="description" required placeholder="Décrivez la modification, son objectif, les étapes réalisées, les fichiers modifiés, etc."></textarea>
                        </div>

                        <div class="form-group">
                            <label for="fichiers">Fichiers/Dossiers modifiés</label>
                            <textarea id="fichiers" placeholder="Liste des fichiers modifiés, chemins, sauvegardes, etc."></textarea>
                        </div>

                        <div class="form-group">
                            <label for="notes">Notes complémentaires</label>
                            <textarea id="notes" placeholder="Tests effectués, problèmes rencontrés, points d'attention, etc."></textarea>
                        </div>

                        <button type="submit" class="btn">💾 Enregistrer la modification</button>
                        <button type="button" class="btn btn-secondary" onclick="clearForm()">🗑️ Effacer</button>
                    </form>
                </div>

                <!-- Actions globales -->
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-secondary" onclick="exportData()">📤 Exporter les données</button>
                    <button class="btn" onclick="document.getElementById('importFile').click()">📥 Importer des données</button>
                    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(this)">
                    <button class="btn btn-danger" onclick="clearAllData()">🗑️ Effacer toutes les données</button>
                </div>
            </div>

            <!-- Tab À faire -->
            <div id="tab-a-faire" class="tab-content">
                <div class="form-section">
                    <h3>⏳ Modifications à faire</h3>
                    <p>Liste des modifications planifiées qui attendent d'être réalisées</p>
                </div>
                
                <!-- Filtres spécifiques -->
                <div class="filters">
                    <div class="form-group">
                        <label for="searchFilterAFaire">🔍 Recherche</label>
                        <input type="text" id="searchFilterAFaire" placeholder="Rechercher...">
                    </div>
                    <div class="form-group">
                        <label for="moduleFilterAFaire">Module</label>
                        <select id="moduleFilterAFaire">
                            <option value="">Tous les modules</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="prioriteFilterAFaire">Priorité</label>
                        <select id="prioriteFilterAFaire">
                            <option value="">Toutes priorités</option>
                        </select>
                    </div>
                </div>
                
                <div class="modifications-list" id="modificationsListAFaire"></div>
            </div>

            <!-- Tab En cours -->
            <div id="tab-en-cours" class="tab-content">
                <div class="form-section">
                    <h3>⚙️ Modifications en cours</h3>
                    <p>Liste des modifications actuellement en développement</p>
                </div>
                
                <div class="filters">
                    <div class="form-group">
                        <label for="searchFilterEnCours">🔍 Recherche</label>
                        <input type="text" id="searchFilterEnCours" placeholder="Rechercher...">
                    </div>
                    <div class="form-group">
                        <label for="moduleFilterEnCours">Module</label>
                        <select id="moduleFilterEnCours">
                            <option value="">Tous les modules</option>
                        </select>
                    </div>
                </div>
                
                <div class="modifications-list" id="modificationsListEnCours"></div>
            </div>

            <!-- Tab En test -->
            <div id="tab-en-test" class="tab-content">
                <div class="form-section">
                    <h3>🔍 Modifications en test</h3>
                    <p>Liste des modifications en phase de test et validation</p>
                </div>
                
                <div class="filters">
                    <div class="form-group">
                        <label for="searchFilterEnTest">🔍 Recherche</label>
                        <input type="text" id="searchFilterEnTest" placeholder="Rechercher...">
                    </div>
                    <div class="form-group">
                        <label for="moduleFilterEnTest">Module</label>
                        <select id="moduleFilterEnTest">
                            <option value="">Tous les modules</option>
                        </select>
                    </div>
                </div>
                
                <div class="modifications-list" id="modificationsListEnTest"></div>
            </div>

            <!-- Tab Terminées -->
            <div id="tab-terminees" class="tab-content">
                <div class="form-section">
                    <h3>✅ Modifications terminées</h3>
                    <p>Archive de toutes les modifications complétées avec succès</p>
                </div>
                
                <div class="filters">
                    <div class="form-group">
                        <label for="searchFilterTerminees">🔍 Recherche</label>
                        <input type="text" id="searchFilterTerminees" placeholder="Rechercher...">
                    </div>
                    <div class="form-group">
                        <label for="moduleFilterTerminees">Module</label>
                        <select id="moduleFilterTerminees">
                            <option value="">Tous les modules</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="dateFilterTerminees">Période</label>
                        <select id="dateFilterTerminees">
                            <option value="">Toutes périodes</option>
                            <option value="7">7 derniers jours</option>
                            <option value="30">30 derniers jours</option>
                            <option value="90">3 derniers mois</option>
                        </select>
                    </div>
                </div>
                
                <div class="modifications-list" id="modificationsListTerminees"></div>
            </div>

            <!-- Tab Toutes -->
            <div id="tab-toutes" class="tab-content">
                <div class="form-section">
                    <h3>📋 Toutes les modifications</h3>
                    <p>Vue complète de toutes vos modifications Dolibarr</p>
                </div>
                
                <!-- Filtres et recherche -->
                <div class="filters">
                    <div class="form-group">
                        <label for="searchFilter">🔍 Recherche</label>
                        <input type="text" id="searchFilter" placeholder="Rechercher dans les modifications...">
                    </div>
                    <div class="form-group">
                        <label for="moduleFilter">Module</label>
                        <select id="moduleFilter">
                            <option value="">Tous les modules</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="statutFilter">Statut</label>
                        <select id="statutFilter">
                            <option value="">Tous les statuts</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="prioriteFilter">Priorité</label>
                        <select id="prioriteFilter">
                            <option value="">Toutes priorités</option>
                        </select>
                    </div>
                </div>

                <!-- Liste des modifications -->
                <div class="modifications-list" id="modificationsList"></div>
            </div>
        </div>
        </div>
    </div>

    <script>
        let modifications = [];
        let editingId = null;
        let currentTab = 'accueil';

        // Charger les données au démarrage
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            updateStats();
            populateFilters();
            setupEventListeners();
            updateNavBadges();
            updateLastSaveInfo();
            updateTodayFilename();
        });

        function updateTodayFilename() {
            const today = new Date();
            const day = String(today.getDate()).padStart(2, '0');
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const year = today.getFullYear();
            const filename = `taches_${day}-${month}-${year}.json`;
            
            document.getElementById('todayFilename').textContent = filename;
            
            // Mettre à jour le bouton selon s'il y a des données
            const downloadBtn = document.getElementById('downloadBtn');
            if (modifications.length === 0) {
                downloadBtn.disabled = true;
                downloadBtn.innerHTML = '📥 Aucune donnée à télécharger';
            } else {
                downloadBtn.disabled = false;
                downloadBtn.innerHTML = `📥 Télécharger directement (${modifications.length} modifs)`;
            }
        }

        function downloadTodayFile() {
            if (modifications.length === 0) {
                alert('⚠️ Aucune modification à télécharger.\n\nAjoutez d\'abord des modifications pour pouvoir les télécharger.');
                return;
            }

            const today = new Date();
            const day = String(today.getDate()).padStart(2, '0');
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const year = today.getFullYear();
            const filename = `taches_${day}-${month}-${year}.json`;

            const exportObj = {
                metadata: {
                    version: "1.0",
                    exportDate: new Date().toISOString(),
                    totalModifications: modifications.length,
                    exportedBy: "Suivi Modifications Dolibarr",
                    filename: filename
                },
                modifications: modifications
            };
            
            const data = JSON.stringify(exportObj, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            
            URL.revokeObjectURL(url);
            
            // Message de confirmation optimisé
            const message = `✅ Téléchargement réussi !\n\n📄 Fichier : ${filename}\n🔢 ${modifications.length} modification(s) incluse(s)\n\n💡 Le fichier est téléchargé dans votre dossier de téléchargements par défaut.`;
            alert(message);
        }

        function updateLastSaveInfo() {
            const lastSave = localStorage.getItem('dolibarr-last-save');
            const infoElement = document.getElementById('lastSaveInfo');
            
            if (lastSave && infoElement) {
                const saveDate = new Date(lastSave);
                const now = new Date();
                const diffMinutes = Math.floor((now - saveDate) / (1000 * 60));
                
                let timeText = '';
                if (diffMinutes < 1) {
                    timeText = 'à l\'instant';
                } else if (diffMinutes < 60) {
                    timeText = `il y a ${diffMinutes} min`;
                } else if (diffMinutes < 1440) {
                    timeText = `il y a ${Math.floor(diffMinutes / 60)}h`;
                } else {
                    timeText = saveDate.toLocaleDateString('fr-FR');
                }
                
                infoElement.textContent = `• Dernière sauvegarde: ${timeText}`;
            }
        }

        function setupEventListeners() {
            document.getElementById('modificationForm').addEventListener('submit', handleSubmit);
            
            // Navigation
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    switchTab(this.dataset.tab);
                });
            });

            // Filtres pour chaque onglet
            setupFiltersForTab('');
            setupFiltersForTab('AFaire');
            setupFiltersForTab('EnCours');
            setupFiltersForTab('EnTest');
            setupFiltersForTab('Terminees');
            
            // Filtres pour l'onglet "toutes"
            document.getElementById('searchFilter').addEventListener('input', filterModifications);
            document.getElementById('moduleFilter').addEventListener('change', filterModifications);
            document.getElementById('statutFilter').addEventListener('change', filterModifications);
            document.getElementById('prioriteFilter').addEventListener('change', filterModifications);
        }

        function setupFiltersForTab(suffix) {
            const searchId = `searchFilter${suffix}`;
            const moduleId = `moduleFilter${suffix}`;
            const prioriteId = `prioriteFilter${suffix}`;
            
            const searchEl = document.getElementById(searchId);
            const moduleEl = document.getElementById(moduleId);
            const prioriteEl = document.getElementById(prioriteId);
            
            if (searchEl) searchEl.addEventListener('input', () => filterModificationsByTab(suffix));
            if (moduleEl) moduleEl.addEventListener('change', () => filterModificationsByTab(suffix));
            if (prioriteEl) prioriteEl.addEventListener('change', () => filterModificationsByTab(suffix));
        }

        function switchTab(tabName) {
            // Mettre à jour les onglets
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

            // Mettre à jour le contenu
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`tab-${tabName}`).classList.add('active');

            currentTab = tabName;

            // Charger le contenu spécifique à l'onglet
            switch(tabName) {
                case 'accueil':
                    renderRecentModifications();
                    break;
                case 'a-faire':
                    renderModificationsByStatus(['Planifiée'], 'modificationsListAFaire');
                    break;
                case 'en-cours':
                    renderModificationsByStatus(['En cours'], 'modificationsListEnCours');
                    break;
                case 'en-test':
                    renderModificationsByStatus(['En test'], 'modificationsListEnTest');
                    break;
                case 'terminees':
                    renderModificationsByStatus(['Terminée'], 'modificationsListTerminees');
                    break;
                case 'toutes':
                    renderModifications();
                    break;
            }
            
            populateFiltersForTab(tabName);
        }

        function updateNavBadges() {
            const aFaire = modifications.filter(m => m.statut === 'Planifiée').length;
            const enCours = modifications.filter(m => m.statut === 'En cours').length;
            const enTest = modifications.filter(m => m.statut === 'En test').length;
            const terminees = modifications.filter(m => m.statut === 'Terminée').length;
            const total = modifications.length;

            updateBadge('navBadgeAFaire', aFaire);
            updateBadge('navBadgeEnCours', enCours);
            updateBadge('navBadgeEnTest', enTest);
            updateBadge('navBadgeTerminees', terminees);
            updateBadge('navBadgeToutes', total);
        }

        function updateBadge(badgeId, count) {
            const badge = document.getElementById(badgeId);
            if (badge) {
                badge.textContent = count;
                badge.className = count === 0 ? 'nav-badge zero' : 'nav-badge';
            }
        }

        function renderModificationsByStatus(statuses, containerId) {
            const filtered = modifications.filter(mod => statuses.includes(mod.statut));
            renderModificationsInContainer(filtered, containerId);
        }

        function renderRecentModifications() {
            const recent = modifications.slice(0, 5); // 5 dernières
            const container = document.getElementById('recentModifications');
            
            if (recent.length === 0) {
                container.innerHTML = '<p style="color: #7f8c8d; text-align: center; padding: 20px; font-size: 0.85rem;">Aucune modification récente</p>';
                return;
            }

            container.innerHTML = recent.map(mod => `
                <div class="modification-item">
                    <div class="modification-title">${mod.titre}</div>
                    <div class="modification-meta">
                        ${mod.statut ? `<span class="badge badge-status">${mod.statut}</span>` : ''}
                        ${mod.module ? `<span class="badge badge-module">${mod.module}</span>` : ''}
                        ${mod.priorite ? `<span class="badge badge-priority">${mod.priorite}</span>` : ''}
                    </div>
                </div>
            `).join('');
        }

        function renderModificationsInContainer(modificationsList, containerId) {
            const container = document.getElementById(containerId);
            
            if (!container) return;
            
            if (modificationsList.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div style="font-size: 4rem; margin-bottom: 20px; opacity: 0.3;">📝</div>
                        <h3>Aucune modification trouvée</h3>
                        <p>Aucune modification ne correspond à ce statut</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = modificationsList.map(mod => `
                <div class="modification-item">
                    <div class="modification-header">
                        <div class="modification-title">${mod.titre}</div>
                        <div class="modification-date">
                            ${new Date(mod.dateCreation).toLocaleDateString('fr-FR')}
                        </div>
                    </div>
                    
                    <div class="modification-meta">
                        ${mod.module ? `<div class="meta-item"><span class="badge badge-module">${mod.module}</span></div>` : ''}
                        ${mod.type ? `<div class="meta-item"><span class="badge badge-type">${mod.type}</span></div>` : ''}
                        ${mod.priorite ? `<div class="meta-item"><span class="badge badge-priority">${mod.priorite}</span></div>` : ''}
                        ${mod.statut ? `<div class="meta-item"><span class="badge badge-status">${mod.statut}</span></div>` : ''}
                        ${mod.version ? `<div class="meta-item">📦 v${mod.version}</div>` : ''}
                        ${mod.responsable ? `<div class="meta-item">👤 ${mod.responsable}</div>` : ''}
                    </div>

                    ${mod.dateDebut || mod.dateFin ? `
                        <div class="modification-meta">
                            ${mod.dateDebut ? `<div class="meta-item">📅 Début: ${new Date(mod.dateDebut).toLocaleDateString('fr-FR')}</div>` : ''}
                            ${mod.dateFin ? `<div class="meta-item">🎯 Fin prévue: ${new Date(mod.dateFin).toLocaleDateString('fr-FR')}</div>` : ''}
                        </div>
                    ` : ''}

                    <div class="modification-description">
                        <strong>Description:</strong><br>
                        ${mod.description.replace(/\n/g, '<br>')}
                        
                        ${mod.fichiers ? `<br><br><strong>Fichiers modifiés:</strong><br>${mod.fichiers.replace(/\n/g, '<br>')}` : ''}
                        ${mod.notes ? `<br><br><strong>Notes:</strong><br>${mod.notes.replace(/\n/g, '<br>')}` : ''}
                    </div>

                    <div class="actions">
                        <button class="btn btn-small" onclick="editModification('${mod.id}')">✏️ Modifier</button>
                        <button class="btn btn-small btn-danger" onclick="deleteModification('${mod.id}')">🗑️ Supprimer</button>
                    </div>
                </div>
            `).join('');
        }

        function filterModificationsByTab(suffix) {
            const searchId = `searchFilter${suffix}`;
            const moduleId = `moduleFilter${suffix}`;
            const prioriteId = `prioriteFilter${suffix}`;
            
            const search = document.getElementById(searchId)?.value.toLowerCase() || '';
            const moduleFilter = document.getElementById(moduleId)?.value || '';
            const prioriteFilter = document.getElementById(prioriteId)?.value || '';

            let baseModifications = modifications;
            
            // Filtrer selon l'onglet actuel
            switch(currentTab) {
                case 'a-faire':
                    baseModifications = modifications.filter(m => m.statut === 'Planifiée');
                    break;
                case 'en-cours':
                    baseModifications = modifications.filter(m => m.statut === 'En cours');
                    break;
                case 'en-test':
                    baseModifications = modifications.filter(m => m.statut === 'En test');
                    break;
                case 'terminees':
                    baseModifications = modifications.filter(m => m.statut === 'Terminée');
                    break;
            }

            let filtered = baseModifications.filter(mod => {
                const matchesSearch = !search || 
                    mod.titre.toLowerCase().includes(search) ||
                    mod.description.toLowerCase().includes(search) ||
                    (mod.notes && mod.notes.toLowerCase().includes(search));
                
                const matchesModule = !moduleFilter || mod.module === moduleFilter;
                const matchesPriorite = !prioriteFilter || mod.priorite === prioriteFilter;

                return matchesSearch && matchesModule && matchesPriorite;
            });

            // Rendre dans le bon conteneur
            const containerId = `modificationsList${suffix}`;
            renderModificationsInContainer(filtered, containerId);
        }

        function populateFiltersForTab(tabName) {
            const modules = [...new Set(modifications.map(m => m.module).filter(Boolean))];
            const priorites = [...new Set(modifications.map(m => m.priorite).filter(Boolean))];

            switch(tabName) {
                case 'a-faire':
                    updateSelectOptions('moduleFilterAFaire', modules);
                    updateSelectOptions('prioriteFilterAFaire', priorites);
                    break;
                case 'en-cours':
                    updateSelectOptions('moduleFilterEnCours', modules);
                    break;
                case 'en-test':
                    updateSelectOptions('moduleFilterEnTest', modules);
                    break;
                case 'terminees':
                    updateSelectOptions('moduleFilterTerminees', modules);
                    break;
                case 'toutes':
                    updateSelectOptions('moduleFilter', modules);
                    updateSelectOptions('prioriteFilter', priorites);
                    const statuts = [...new Set(modifications.map(m => m.statut).filter(Boolean))];
                    updateSelectOptions('statutFilter', statuts);
                    break;
            }
        }

        function handleSubmit(e) {
            e.preventDefault();
            
            const formData = {
                id: editingId || Date.now().toString(),
                titre: document.getElementById('titre').value,
                module: document.getElementById('module').value,
                type: document.getElementById('type').value,
                priorite: document.getElementById('priorite').value,
                statut: document.getElementById('statut').value,
                version: document.getElementById('version').value,
                dateDebut: document.getElementById('dateDebut').value,
                dateFin: document.getElementById('dateFin').value,
                responsable: document.getElementById('responsable').value,
                description: document.getElementById('description').value,
                fichiers: document.getElementById('fichiers').value,
                notes: document.getElementById('notes').value,
                dateCreation: editingId ? modifications.find(m => m.id === editingId).dateCreation : new Date().toISOString()
            };

            if (editingId) {
                const index = modifications.findIndex(m => m.id === editingId);
                modifications[index] = formData;
                editingId = null;
            } else {
                modifications.unshift(formData);
            }

            saveData();
            updateStats();
            updateNavBadges();
            updateLastSaveInfo();
            updateTodayFilename(); // Mettre à jour le bouton de téléchargement
            populateFilters();
            populateFiltersForTab(currentTab);
            clearForm();
            
            // Rafraîchir la vue actuelle
            switchTab(currentTab);
        }

        function deleteModification(id) {
            if (confirm('Êtes-vous sûr de vouloir supprimer cette modification ?')) {
                modifications = modifications.filter(m => m.id !== id);
                saveData();
                updateStats();
                updateNavBadges();
                updateLastSaveInfo();
                updateTodayFilename(); // Mettre à jour le bouton de téléchargement
                populateFilters();
                populateFiltersForTab(currentTab);
                
                // Rafraîchir la vue actuelle
                switchTab(currentTab);
            }
        }

        function editModification(id) {
            const modification = modifications.find(m => m.id === id);
            if (!modification) return;

            editingId = id;
            
            document.getElementById('titre').value = modification.titre;
            document.getElementById('module').value = modification.module;
            document.getElementById('type').value = modification.type;
            document.getElementById('priorite').value = modification.priorite;
            document.getElementById('statut').value = modification.statut;
            document.getElementById('version').value = modification.version;
            document.getElementById('dateDebut').value = modification.dateDebut;
            document.getElementById('dateFin').value = modification.dateFin;
            document.getElementById('responsable').value = modification.responsable;
            document.getElementById('description').value = modification.description;
            document.getElementById('fichiers').value = modification.fichiers;
            document.getElementById('notes').value = modification.notes;

            // Basculer vers l'onglet accueil pour modifier
            switchTab('accueil');
            
            // Scroll to form
            document.querySelector('.form-section').scrollIntoView({ behavior: 'smooth' });
        }

        function renderModifications() {
            renderModificationsInContainer(modifications, 'modificationsList');
        }

        function filterModifications() {
            const search = document.getElementById('searchFilter').value.toLowerCase();
            const moduleFilter = document.getElementById('moduleFilter').value;
            const statutFilter = document.getElementById('statutFilter').value;
            const prioriteFilter = document.getElementById('prioriteFilter').value;

            let filtered = modifications.filter(mod => {
                const matchesSearch = !search || 
                    mod.titre.toLowerCase().includes(search) ||
                    mod.description.toLowerCase().includes(search) ||
                    (mod.notes && mod.notes.toLowerCase().includes(search));
                
                const matchesModule = !moduleFilter || mod.module === moduleFilter;
                const matchesStatut = !statutFilter || mod.statut === statutFilter;
                const matchesPriorite = !prioriteFilter || mod.priorite === prioriteFilter;

                return matchesSearch && matchesModule && matchesStatut && matchesPriorite;
            });

            renderModificationsInContainer(filtered, 'modificationsList');
        }

        function updateStats() {
            const total = modifications.length;
            const pending = modifications.filter(m => m.statut === 'Planifiée' || m.statut === 'En cours').length;
            const completed = modifications.filter(m => m.statut === 'Terminée').length;
            const testing = modifications.filter(m => m.statut === 'En test').length;

            document.getElementById('totalModifications').textContent = total;
            document.getElementById('pendingModifications').textContent = pending;
            document.getElementById('completedModifications').textContent = completed;
            document.getElementById('testingModifications').textContent = testing;
        }

        function populateFilters() {
            const modules = [...new Set(modifications.map(m => m.module).filter(Boolean))];
            const statuts = [...new Set(modifications.map(m => m.statut).filter(Boolean))];
            const priorites = [...new Set(modifications.map(m => m.priorite).filter(Boolean))];

            updateSelectOptions('moduleFilter', modules);
            updateSelectOptions('statutFilter', statuts);
            updateSelectOptions('prioriteFilter', priorites);
        }

        function updateSelectOptions(selectId, options) {
            const select = document.getElementById(selectId);
            const currentValue = select.value;
            const firstOption = select.children[0];
            
            select.innerHTML = '';
            select.appendChild(firstOption);
            
            options.forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.value = option;
                optionElement.textContent = option;
                select.appendChild(optionElement);
            });
            
            select.value = currentValue;
        }

        function saveData() {
            try {
                localStorage.setItem('dolibarr-modifications', JSON.stringify(modifications));
                localStorage.setItem('dolibarr-last-save', new Date().toISOString());
                console.log('✅ Données sauvegardées automatiquement:', modifications.length, 'modifications');
            } catch (error) {
                console.error('❌ Erreur lors de la sauvegarde:', error);
                alert('Erreur lors de la sauvegarde locale. Pensez à exporter vos données !');
            }
        }

        function loadData() {
            try {
                const saved = localStorage.getItem('dolibarr-modifications');
                const lastSave = localStorage.getItem('dolibarr-last-save');
                
                if (saved) {
                    modifications = JSON.parse(saved);
                    console.log('📂 Données chargées depuis localStorage:', modifications.length, 'modifications');
                    
                    if (lastSave) {
                        const saveDate = new Date(lastSave).toLocaleString('fr-FR');
                        console.log('📅 Dernière sauvegarde:', saveDate);
                    }
                } else {
                    modifications = [];
                    console.log('🆕 Nouvelle session - aucune donnée locale trouvée');
                }
            } catch (error) {
                console.error('❌ Erreur lors du chargement:', error);
                modifications = [];
            }
        }

        function exportData() {
            const exportObj = {
                metadata: {
                    version: "1.0",
                    exportDate: new Date().toISOString(),
                    totalModifications: modifications.length,
                    exportedBy: "Suivi Modifications Dolibarr"
                },
                modifications: modifications
            };
            
            const data = JSON.stringify(exportObj, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `modifications-dolibarr-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            
            URL.revokeObjectURL(url);
            
            // Afficher un message de confirmation
            alert(`📤 Export réussi !\n\n${modifications.length} modifications exportées.\nFichier: ${a.download}\n\n💡 Partagez ce fichier avec votre équipe via votre drive commun.`);
        }

        function importData(input) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const jsonData = JSON.parse(e.target.result);
                    
                    // Vérifier le format du fichier
                    let importedModifications = [];
                    if (jsonData.modifications && Array.isArray(jsonData.modifications)) {
                        // Format avec métadonnées (nouveau format)
                        importedModifications = jsonData.modifications;
                        console.log('📥 Import avec métadonnées détecté');
                    } else if (Array.isArray(jsonData)) {
                        // Format direct (ancien format)
                        importedModifications = jsonData;
                        console.log('📥 Import format direct détecté');
                    } else {
                        throw new Error('Format de fichier non reconnu');
                    }

                    // Demander confirmation si des données existent déjà
                    if (modifications.length > 0) {
                        const choice = confirm(
                            `⚠️ Vous avez déjà ${modifications.length} modification(s) locale(s).\n\n` +
                            `Le fichier contient ${importedModifications.length} modification(s).\n\n` +
                            `Choisissez votre action :\n` +
                            `• OK = REMPLACER toutes vos données locales\n` +
                            `• Annuler = FUSIONNER (ajouter les nouvelles)`
                        );
                        
                        if (choice) {
                            // Remplacer
                            modifications = importedModifications;
                        } else {
                            // Fusionner - éviter les doublons par ID
                            const existingIds = new Set(modifications.map(m => m.id));
                            const newModifications = importedModifications.filter(m => !existingIds.has(m.id));
                            modifications = [...modifications, ...newModifications];
                            
                            alert(`🔄 Fusion réussie !\n\n${newModifications.length} nouvelles modifications ajoutées.\nTotal: ${modifications.length} modifications.`);
                        }
                    } else {
                        modifications = importedModifications;
                    }

                    // Sauvegarder et mettre à jour l'interface
                    saveData();
                    updateStats();
                    updateNavBadges();
                    updateTodayFilename(); // Mettre à jour le bouton de téléchargement
                    populateFilters();
                    populateFiltersForTab(currentTab);
                    switchTab(currentTab);
                    
                    if (modifications.length === importedModifications.length) {
                        alert(`✅ Import réussi !\n\n${importedModifications.length} modifications chargées.`);
                    }
                    
                } catch (error) {
                    console.error('❌ Erreur lors de l\'import:', error);
                    alert(`❌ Erreur lors de l'import du fichier :\n\n${error.message}\n\nVérifiez que le fichier est un export valide.`);
                }
            };
            
            reader.onerror = function() {
                alert('❌ Erreur lors de la lecture du fichier.');
            };
            
            reader.readAsText(file);
            
            // Reset input pour permettre de réimporter le même fichier
            input.value = '';
        }

        function clearForm() {
            document.getElementById('modificationForm').reset();
            document.getElementById('priorite').value = 'Normale';
            document.getElementById('statut').value = 'En cours';
            editingId = null;
        }

        function clearAllData() {
            if (confirm('Êtes-vous sûr de vouloir supprimer TOUTES les modifications ? Cette action est irréversible.')) {
                modifications = [];
                saveData();
                updateStats();
                updateNavBadges();
                updateLastSaveInfo();
                updateTodayFilename(); // Mettre à jour le bouton de téléchargement
                populateFilters();
                populateFiltersForTab(currentTab);
                switchTab(currentTab);
            }
        }
    </script>
</body>
</html>